---
layout: default
title: Checkout - Roza Bridal
---

<div class="checkout-container">
  <div class="checkout-form">
    <h2>Checkout</h2>
    
    <div class="checkout-section">
      <h3>Contact Information</h3>
      <div class="form-group">
        <label for="checkout-email">Email</label>
        <input type="email" id="checkout-email" required>
      </div>
      <div class="form-group">
        <label for="checkout-phone">Phone</label>
        <input type="tel" id="checkout-phone" required>
      </div>
    </div>
    
    <!-- REMOVED SHIPPING ADDRESS - STRIPE HANDLES THIS -->
    
    <div class="checkout-section">
      <h3>Order Notes</h3>
      <div class="form-group">
        <label for="order-notes">Special Instructions (Optional)</label>
        <textarea id="order-notes" rows="6" placeholder="Any special instructions, timeline requirements, or customization notes..." style="width: 100%; padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 1rem; line-height: 1.5; resize: vertical; min-height: 120px;"></textarea>
        <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem; margin-bottom: 0;">
          üí° <strong>Tip:</strong> Include any custom measurements, color preferences, or special requests here
        </p>
      </div>
    </div>
    
    <div class="checkout-notice" style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); padding: 1.5rem; border-radius: 8px; margin: 2rem 0; border-left: 4px solid #6772e5;">
      <h4 style="margin: 0 0 1rem; color: #1a1a1a; display: flex; align-items: center; gap: 0.5rem;">
        <span style="font-size: 1.2rem;">üîí</span> Secure Stripe Checkout
      </h4>
      <ul style="margin: 0; padding-left: 1.5rem; color: #555; line-height: 1.6;">
        <li><strong>Shipping Address:</strong> Collected securely during Stripe checkout</li>
        <li><strong>Payment:</strong> Credit card, debit card, or digital wallet</li>
        <li><strong>Security:</strong> Bank-level encryption and PCI compliance</li>
        <li><strong>International:</strong> Shipping available to supported countries</li>
      </ul>
    </div>
  </div>
  
  <div class="checkout-summary">
    <h2>Order Summary</h2>
    
    <!-- Empty cart message -->
    <div class="empty-cart-notice" id="empty-cart-notice" style="text-align: center; padding: 3rem 1rem; color: #666; display: none;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üõçÔ∏è</div>
      <h3 style="margin-bottom: 1rem; color: #333;">Your cart is empty</h3>
      <p style="margin-bottom: 2rem;">Add some beautiful dresses to your cart before checkout.</p>
      <a href="{{ site.baseurl }}/products/" style="display: inline-block; padding: 1rem 2rem; background: #c9a96e; color: white; text-decoration: none; border-radius: 50px; font-weight: 600;">Browse Dresses</a>
    </div>
    
    <div class="checkout-items" id="checkout-items">
      <!-- Items will be populated by JavaScript -->
    </div>
    
    <div class="checkout-totals" id="checkout-totals">
      <div class="checkout-total-row">
        <span>Subtotal</span>
        <span id="checkout-subtotal">$0.00</span>
      </div>
      <div class="checkout-total-row">
        <span>Shipping</span>
        <span id="checkout-shipping" style="color: #28a745; font-weight: 600;">FREE SHIPPING</span>
      </div>
      <div class="checkout-total-row final">
        <span>Total</span>
        <span id="checkout-total">$0.00</span>
      </div>
    </div>
    
    <!-- SINGLE STRIPE CHECKOUT BUTTON -->
    <button class="stripe-checkout-button" id="stripe-checkout-button">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
        <line x1="8" y1="21" x2="16" y2="21"/>
        <line x1="12" y1="17" x2="12" y2="21"/>
      </svg>
      Complete Secure Checkout
    </button>
    
    <div class="checkout-security" style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
      <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîê</div>
      <p style="margin: 0; font-size: 0.9rem; color: #666;">
        Your payment and shipping information is processed securely by Stripe
      </p>
    </div>
    
    <!-- Stripe Benefits -->
    <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
      <h4 style="margin: 0 0 1rem; color: #1a1a1a; font-size: 0.95rem; text-align: center;">‚ú® What's Included</h4>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; text-align: center; font-size: 0.8rem; color: #666;">
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
          <span style="font-size: 1.2rem;">üöö</span>
          <span>Free Shipping</span>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
          <span style="font-size: 1.2rem;">üõ°Ô∏è</span>
          <span>Buyer Protection</span>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
          <span style="font-size: 1.2rem;">üìû</span>
          <span>24/7 Support</span>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
          <span style="font-size: 1.2rem;">‚Ü©Ô∏è</span>
          <span>Easy Returns</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- STRIPE PAYMENT LINKS CONFIGURATION -->
<script>
const STRIPE_PAYMENT_LINKS = {
  'boho-wedding-dress-elegant': 'https://buy.stripe.com/4gM3cv3TA7sRc093EN1B600',
  'boho-beach-wedding-dress': 'https://buy.stripe.com/7sY6oHdua7sR6FP0sB1B601',
  'custom-lace-mermaid-wedding-dress': 'https://buy.stripe.com/5kQ00jcq614t4xH2AJ1B602',
  'elegant-ivory-satin-bridal-gown': 'https://buy.stripe.com/3cI4gz2Pw8wV7JT6QZ1B604',
  'floral-bridal-dress': 'https://buy.stripe.com/cNi3cv9dUfZnggpcbj1B605',
  'gorgeous-ivory-mermaid-wedding-gown': 'https://buy.stripe.com/7sYaEX75MdRf0hrgrz1B606',
  'minimalist-off-shoulder-satin-dress': 'https://buy.stripe.com/28E9ATgGm9AZ7JTdfn1B607',
  'sexy-sequin-mermaid-wedding-dress': 'https://buy.stripe.com/7sY00jeye28xe8h7V31B60a',
  'sexy-fishtail-bridal-gown': 'https://buy.stripe.com/eVqdR9bm2fZn4xHcbj1B609',
  'modest-satin-wedding-dress': 'https://buy.stripe.com/4gM3cvcq6cNbc09dfn1B608'
};

// Enhanced checkout functionality - STRIPE ONLY
document.addEventListener('DOMContentLoaded', function() {
  loadCheckoutData();
  setupStripeCheckout();
});

function setupStripeCheckout() {
  const stripeButton = document.getElementById('stripe-checkout-button');
  
  stripeButton.addEventListener('click', function() {
    processStripeCheckout();
  });
}

function processStripeCheckout() {
  if (!validateCheckoutForm()) return;
  
  const cartData = localStorage.getItem('rozaBridalCart');
  const cartItems = cartData ? JSON.parse(cartData) : [];
  
  if (cartItems.length === 0) {
    alert('Your cart is empty!');
    return;
  }
  
  // Show processing state
  const button = document.getElementById('stripe-checkout-button');
  const originalText = button.innerHTML;
  button.innerHTML = '<div class="spinner"></div> Processing...';
  button.disabled = true;
  
  // For single item, use direct Stripe link
  if (cartItems.length === 1) {
    const item = cartItems[0];
    const productId = extractProductIdFromName(item.name);
    const stripeLink = STRIPE_PAYMENT_LINKS[productId];
    
    if (stripeLink) {
      // Save order details for post-purchase processing
      const orderData = createOrderData();
      localStorage.setItem('pendingStripeOrder', JSON.stringify(orderData));
      
      // Track checkout
      if (typeof ml !== 'undefined') {
        ml('track', 'stripe_checkout_started', {
          product_id: productId,
          product_name: item.name,
          total_amount: calculateTotal(),
          has_customizations: item.isCustom || false
        });
      }
      
      // Redirect to Stripe
      window.location.href = stripeLink;
      return;
    }
  }
  
  // For multiple items or items without direct Stripe links
  // Show contact message instead of failing
  button.innerHTML = originalText;
  button.disabled = false;
  
  alert('üîî Multiple Items Detected\n\nFor orders with multiple items or custom designs, our team will contact you within 24 hours with a secure payment link.\n\nYour order details have been saved.');
  
  // Send order via email for manual processing
  const orderData = createOrderData();
  saveOrderToStorage(orderData);
  sendOrderEmail(orderData);
  
  // Clear cart and redirect
  localStorage.removeItem('rozaBridalCart');
  window.location.href = `${document.querySelector('meta[name="base-url"]')?.content || ''}/`;
}

function extractProductIdFromName(productName) {
  const nameMap = {
    'Boho Wedding Dress Elegant': 'boho-wedding-dress-elegant',
    'Boho Beach Wedding Dress': 'boho-beach-wedding-dress',
    'Custom Lace Mermaid Wedding Dress': 'custom-lace-mermaid-wedding-dress',
    'Elegant Ivory Satin Bridal Gown': 'elegant-ivory-satin-bridal-gown',
    'Floral Bridal Dress': 'floral-bridal-dress',
    'Gorgeous Ivory Mermaid Wedding Gown': 'gorgeous-ivory-mermaid-wedding-gown',
    'Minimalist Off Shoulder Satin Wedding Dress': 'minimalist-off-shoulder-satin-dress',
    'Sexy Sequin Mermaid Wedding Dress': 'sexy-sequin-mermaid-wedding-dress',
    'Sexy Fishtail Bridal Gown': 'sexy-fishtail-bridal-gown',
    'Modest Satin Wedding Dress': 'modest-satin-wedding-dress'
  };
  
  return nameMap[productName] || null;
}

function createOrderData() {
  const cartData = localStorage.getItem('rozaBridalCart');
  const cartItems = cartData ? JSON.parse(cartData) : [];
  
  return {
    contact: {
      email: document.getElementById('checkout-email').value,
      phone: document.getElementById('checkout-phone').value
    },
    notes: document.getElementById('order-notes').value,
    items: cartItems,
    totals: {
      subtotal: calculateTotal(),
      shipping: 0,
      tax: 0,
      total: calculateTotal()
    },
    orderDate: new Date().toISOString(),
    orderId: 'RB-' + Date.now(),
    paymentMethod: 'stripe'
  };
}

function validateCheckoutForm() {
  const requiredFields = [
    'checkout-email',
    'checkout-phone'
  ];
  
  let isValid = true;
  
  requiredFields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (!field.value.trim()) {
      field.style.borderColor = '#dc3545';
      isValid = false;
    } else {
      field.style.borderColor = '#c9a96e';
    }
  });
  
  if (!isValid) {
    alert('Please fill in all required fields.');
    return false;
  }
  
  return true;
}

function calculateTotal() {
  const cartData = localStorage.getItem('rozaBridalCart');
  const cartItems = cartData ? JSON.parse(cartData) : [];
  return cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);
}

function saveOrderToStorage(orderData) {
  const existingOrders = JSON.parse(localStorage.getItem('rozaBridalOrders') || '[]');
  existingOrders.push(orderData);
  localStorage.setItem('rozaBridalOrders', JSON.stringify(existingOrders));
}

function sendOrderEmail(orderData) {
  const itemsList = orderData.items.map(item => {
    const customDetails = item.isCustom && item.customizations ? `
CUSTOM DETAILS:
‚Ä¢ Style: ${item.customizations.style || 'Not specified'}
‚Ä¢ Neckline: ${item.customizations.neckline || 'Not specified'}
‚Ä¢ Color: ${item.customizations.color || 'Not specified'}
‚Ä¢ Fabric: ${item.customizations.fabric || 'Not specified'}
‚Ä¢ Train: ${item.customizations.train || 'Not specified'}
${item.customizations.specialRequests ? `‚Ä¢ Special Requests: ${item.customizations.specialRequests}` : ''}
` : '';
    
    return `
ITEM: ${item.name}
‚Ä¢ Size: ${item.size}
‚Ä¢ Quantity: ${item.quantity}
‚Ä¢ Price: $${item.price.toFixed(2)} each
‚Ä¢ Total: $${(item.price * item.quantity).toFixed(2)}
${customDetails}
`;
  }).join('\n');
  
  const subject = encodeURIComponent(`Multiple Item Order - ${orderData.orderId}`);
  const body = encodeURIComponent(`MULTIPLE ITEM ORDER - STRIPE PROCESSING NEEDED

ORDER ID: ${orderData.orderId}

üìß CUSTOMER CONTACT:
Email: ${orderData.contact.email}
Phone: ${orderData.contact.phone}

üõçÔ∏è ORDER ITEMS:
${itemsList}

üí∞ ORDER TOTALS:
Subtotal: $${orderData.totals.subtotal.toFixed(2)}
Shipping: FREE SHIPPING ‚ú®
TOTAL: $${orderData.totals.total.toFixed(2)}

üìù ORDER NOTES:
${orderData.notes || 'None'}

‚è∞ ORDER DATE: ${new Date(orderData.orderDate).toLocaleString()}

---
NEXT STEPS:
1. Create Stripe payment link for this order
2. Email customer within 24 hours with secure payment link
3. Process order once payment is received

This order requires manual Stripe link creation due to multiple items.`);
  
  window.open(`mailto:aetophis@aetophis.com?subject=${subject}&body=${body}`, '_blank');
}

// Load checkout data function
function loadCheckoutData() {
  const cartData = localStorage.getItem('rozaBridalCart');
  const cartItems = cartData ? JSON.parse(cartData) : [];
  
  const checkoutItems = document.getElementById('checkout-items');
  const emptyCartNotice = document.getElementById('empty-cart-notice');
  const checkoutTotals = document.getElementById('checkout-totals');
  const stripeButton = document.getElementById('stripe-checkout-button');
  
  if (cartItems.length === 0) {
    emptyCartNotice.style.display = 'block';
    checkoutItems.style.display = 'none';
    checkoutTotals.style.display = 'none';
    stripeButton.style.display = 'none';
    return;
  }
  
  // Hide empty cart message
  emptyCartNotice.style.display = 'none';
  checkoutItems.style.display = 'block';
  checkoutTotals.style.display = 'block';
  stripeButton.style.display = 'flex';
  
  // Auto-fill user data if logged in
  const userData = localStorage.getItem('rozaBridalUser');
  if (userData) {
    const user = JSON.parse(userData);
    document.getElementById('checkout-email').value = user.email || '';
  }
  
  // Populate checkout items
  checkoutItems.innerHTML = cartItems.map(item => {
    const customizationHtml = item.isCustom && item.customizations ? `
      <div class="checkout-item-customizations">
        <h5>‚ú® Custom Design Details:</h5>
        <p style="font-size: 0.85rem; line-height: 1.4;">
          <strong>Style:</strong> ${item.customizations.style}<br>
          <strong>Neckline:</strong> ${item.customizations.neckline}<br>
          <strong>Color:</strong> ${item.customizations.color}<br>
          <strong>Fabric:</strong> ${item.customizations.fabric}<br>
          <strong>Train:</strong> ${item.customizations.train}
          ${item.customizations.specialRequests ? `<br><strong>Special Requests:</strong> ${item.customizations.specialRequests}` : ''}
        </p>
      </div>
    ` : '';
    
    return `
      <div class="checkout-item">
        <img src="${item.image}" alt="${item.name}" class="checkout-item-image">
        <div class="checkout-item-details">
          <h4>${item.name}</h4>
          <p class="checkout-item-meta">Size: ${item.size} ‚Ä¢ Quantity: ${item.quantity}</p>
          <p class="checkout-item-price">$${(item.price * item.quantity).toFixed(2)}</p>
          ${customizationHtml}
        </div>
      </div>
    `;
  }).join('');
  
  // Calculate totals
  const subtotal = cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);
  const total = subtotal;
  
  // Update totals
  document.getElementById('checkout-subtotal').textContent = `$${subtotal.toFixed(2)}`;
  document.getElementById('checkout-total').textContent = `$${total.toFixed(2)}`;
}
</script>

<style>
/* Enhanced Stripe Checkout Button */
.stripe-checkout-button {
  width: 100%;
  padding: 1.5rem;
  background: linear-gradient(135deg, #6772e5 0%, #5469d4 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1.1rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  box-shadow: 0 4px 20px rgba(103, 114, 229, 0.3);
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
}

.stripe-checkout-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.6s;
}

.stripe-checkout-button:hover::before {
  left: 100%;
}

.stripe-checkout-button:hover:not(:disabled) {
  background: linear-gradient(135deg, #5469d4 0%, #4c63d2 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(103, 114, 229, 0.4);
}

.stripe-checkout-button:active {
  transform: translateY(0);
}

.stripe-checkout-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

.stripe-checkout-button svg {
  flex-shrink: 0;
}

/* Loading Spinner */
.spinner {
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Enhanced Form Styling */
#order-notes {
  font-family: inherit;
  transition: all 0.3s ease;
}

#order-notes:focus {
  outline: none;
  border-color: #6772e5;
  box-shadow: 0 0 0 3px rgba(103, 114, 229, 0.1);
  transform: scale(1.01);
}

/* Responsive Design */
@media (max-width: 768px) {
  .stripe-checkout-button {
    padding: 1.25rem;
    font-size: 1rem;
  }
  
  .checkout-container {
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  
  .checkout-summary {
    position: static;
    margin-top: 0;
  }
  
  #order-notes {
    min-height: 100px;
  }
}
</style>
