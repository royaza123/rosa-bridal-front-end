---
layout: default
title: Checkout - Roza Bridal
---

<div class="checkout-container">
  <div class="checkout-form">
    <h2>Checkout</h2>
    
    <!-- CONTACT INFORMATION -->
    <div class="checkout-section">
      <h3>Contact Information</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
        <div class="form-group">
          <label for="checkout-first-name">First Name</label>
          <input type="text" id="checkout-first-name" required>
        </div>
        <div class="form-group">
          <label for="checkout-last-name">Last Name</label>
          <input type="text" id="checkout-last-name" required>
        </div>
      </div>
      <div class="form-group">
        <label for="checkout-email">Email</label>
        <input type="email" id="checkout-email" required>
      </div>
      <div class="form-group">
        <label for="checkout-phone">Phone</label>
        <input type="tel" id="checkout-phone" required>
      </div>
    </div>
    
    <!-- WEDDING DETAILS -->
    <div class="checkout-section">
      <h3>Wedding Details (Optional)</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div class="form-group">
          <label for="checkout-wedding-date">Wedding Date</label>
          <input type="date" id="checkout-wedding-date">
        </div>
        <div class="form-group">
          <label for="checkout-venue-style">Venue Style</label>
          <select id="checkout-venue-style">
            <option value="">Select venue style</option>
            <option value="garden">Garden/Outdoor</option>
            <option value="beach">Beach</option>
            <option value="church">Church</option>
            <option value="ballroom">Ballroom</option>
            <option value="rustic">Rustic/Barn</option>
            <option value="destination">Destination</option>
            <option value="city-hall">City Hall</option>
          </select>
        </div>
      </div>
    </div>
    
    <!-- COMMENTS/REQUESTS -->
    <div class="checkout-section">
      <h3>Comments & Special Requests</h3>
      <div class="form-group">
        <label for="order-notes">Tell us anything you'd like us to know</label>
        <textarea id="order-notes" rows="4" placeholder="Any special requests, modifications, timeline requirements, or questions about your order..." style="width: 100%; padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 1rem; line-height: 1.5; resize: vertical;"></textarea>
        <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem; margin-bottom: 0;">
          üí° <strong>Need changes after ordering?</strong> Just contact us anytime - we're happy to help modify your order!
        </p>
      </div>
    </div>
    
    <!-- STRIPE PAYMENT INFO -->
    <div class="stripe-payment-notice">
      <h4>üí≥ Secure Stripe Checkout</h4>
      <ul>
        <li>‚úÖ <strong>Instant Processing:</strong> Complete your order in seconds</li>
        <li>‚úÖ <strong>Bank-Level Security:</strong> Your payment info is 100% secure</li>
        <li>‚úÖ <strong>All Payment Methods:</strong> Credit cards, debit cards, Apple Pay, Google Pay</li>
        <li>‚úÖ <strong>Easy Changes:</strong> Contact us anytime to modify your order</li>
      </ul>
    </div>
  </div>
  
  <div class="checkout-summary">
    <h2>Order Summary</h2>
    
    <!-- Empty cart message -->
    <div class="empty-cart-notice" id="empty-cart-notice" style="text-align: center; padding: 3rem 1rem; color: #666; display: none;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üõçÔ∏è</div>
      <h3 style="margin-bottom: 1rem; color: #333;">Your cart is empty</h3>
      <p style="margin-bottom: 2rem;">Add some beautiful dresses to your cart before checkout.</p>
      <a href="{{ site.baseurl }}/products/" style="display: inline-block; padding: 1rem 2rem; background: #c9a96e; color: white; text-decoration: none; border-radius: 50px; font-weight: 600;">Browse Dresses</a>
    </div>
    
    <div class="checkout-items" id="checkout-items">
      <!-- Items will be populated by JavaScript -->
    </div>
    
    <div class="checkout-totals" id="checkout-totals">
      <div class="checkout-total-row">
        <span>Subtotal</span>
        <span id="checkout-subtotal">$0.00</span>
      </div>
      <div class="checkout-total-row">
        <span>Shipping</span>
        <span id="checkout-shipping" style="color: #28a745; font-weight: 600;">FREE SHIPPING</span>
      </div>
      <div class="checkout-total-row final">
        <span>Total</span>
        <span id="checkout-total">$0.00</span>
      </div>
    </div>
    
    <!-- STRIPE CHECKOUT BUTTON -->
    <button class="stripe-checkout-button" id="stripe-checkout-button" disabled>
      <div class="button-content">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
          <line x1="8" y1="21" x2="16" y2="21"/>
          <line x1="12" y1="17" x2="12" y2="21"/>
        </svg>
        <span>Complete Secure Checkout</span>
      </div>
    </button>
    
    <div class="checkout-security" style="text-align: center; margin-top: 1.5rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
      <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîê</div>
      <p style="margin: 0; font-size: 0.9rem; color: #666;">
        Your payment information is processed securely by Stripe
      </p>
    </div>
    
    <!-- CONTACT INFO -->
    <div class="contact-after-purchase" style="background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%); padding: 1.5rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #28a745;">
      <h4 style="margin: 0 0 1rem; color: #155724; font-size: 1rem;">üí¨ Need Changes After Purchase?</h4>
      <p style="margin: 0; color: #155724; font-size: 0.9rem; line-height: 1.5;">
        No problem! Contact us anytime at <strong>aetophis@aetophis.com</strong> - we're happy to help with any modifications, size changes, or special requests.
      </p>
    </div>
  </div>
</div>

<style>
/* Enhanced Checkout Item Styles */
.checkout-item {
  display: grid;
  grid-template-columns: 100px 1fr auto;
  gap: 1rem;
  padding: 1.5rem;
  border: 1px solid #e8e6e3;
  border-radius: 12px;
  margin-bottom: 1rem;
  background: white;
  position: relative;
  transition: all 0.3s ease;
}

.checkout-item:hover {
  box-shadow: 0 4px 20px rgba(0,0,0,0.05);
  transform: translateY(-1px);
}

.checkout-item-image {
  width: 100px;
  height: 130px;
  object-fit: cover;
  border-radius: 8px;
  background: #f5f5f5;
}

.checkout-item-details {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.checkout-item-details h4 {
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.3rem;
  color: #1a1a1a;
  margin: 0;
  font-weight: 400;
}

.checkout-item-meta {
  color: #666;
  font-size: 0.9rem;
  margin: 0;
}

.checkout-item-price {
  color: #8b7355;
  font-weight: 600;
  font-size: 1.1rem;
  margin: 0.5rem 0;
}

/* Enhanced Customization Display */
.checkout-item-customizations {
  background: linear-gradient(135deg, #f8f6f0 0%, #f5f3ee 100%);
  padding: 1rem;
  border-radius: 8px;
  margin-top: 1rem;
  border-left: 3px solid #8b7355;
}

.checkout-item-customizations h5 {
  margin: 0 0 0.75rem 0;
  color: #8b7355;
  font-size: 1rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.customization-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.customization-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem;
  background: rgba(139, 115, 85, 0.05);
  border-radius: 6px;
  font-size: 0.85rem;
}

.customization-icon {
  font-size: 1rem;
  width: 20px;
  text-align: center;
}

.customization-label {
  font-weight: 600;
  color: #1a1a1a;
}

.customization-value {
  color: #666;
}

.special-requests-display {
  background: rgba(139, 115, 85, 0.08);
  padding: 0.75rem;
  border-radius: 6px;
  margin-top: 0.75rem;
  border-left: 2px solid #8b7355;
}

.special-requests-display strong {
  color: #8b7355;
  font-size: 0.9rem;
}

.special-requests-display p {
  margin: 0.5rem 0 0 0;
  font-size: 0.85rem;
  line-height: 1.4;
  color: #444;
  font-style: italic;
}

/* Remove Button */
.checkout-item-actions {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 1rem;
  position: relative;
}

.remove-checkout-item {
  background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.remove-checkout-item:hover {
  background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
}

.remove-checkout-item svg {
  width: 14px;
  height: 14px;
}

/* Quantity Controls in Checkout */
.checkout-quantity-controls {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.checkout-quantity-btn {
  width: 30px;
  height: 30px;
  background: #f5f5f5;
  border: 1px solid #e0e0e0;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: #8b7355;
  transition: all 0.3s ease;
}

.checkout-quantity-btn:hover {
  background: #8b7355;
  color: white;
  border-color: #8b7355;
}

.checkout-quantity-display {
  padding: 0.25rem 0.75rem;
  background: white;
  border: 1px solid #e0e0e0;
  border-radius: 4px;
  font-weight: 600;
  min-width: 40px;
  text-align: center;
}

/* Stripe Checkout Button */
.stripe-checkout-button {
  width: 100%;
  padding: 1.5rem;
  background: linear-gradient(135deg, #6772e5 0%, #5469d4 100%);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 1.1rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  box-shadow: 0 4px 20px rgba(103, 114, 229, 0.3);
  margin-bottom: 1rem;
  position: relative;
  overflow: hidden;
}

.stripe-checkout-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition: left 0.6s;
}

.stripe-checkout-button:hover::before {
  left: 100%;
}

.stripe-checkout-button:hover:not(:disabled) {
  background: linear-gradient(135deg, #5469d4 0%, #4c63d2 100%);
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(103, 114, 229, 0.4);
}

.stripe-checkout-button:active {
  transform: translateY(0);
}

.stripe-checkout-button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

.stripe-checkout-button svg {
  flex-shrink: 0;
}

/* Stripe Payment Notice */
.stripe-payment-notice {
  background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
  border: 1px solid #6772e5;
  border-radius: 12px;
  padding: 1.5rem;
  margin: 1.5rem 0;
}

.stripe-payment-notice h4 {
  margin: 0 0 1rem 0;
  color: #1a1a1a;
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.stripe-payment-notice ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 0.5rem;
}

.stripe-payment-notice li {
  color: #555;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* Loading Spinner */
.spinner {
  width: 18px;
  height: 18px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
  .stripe-checkout-button {
    padding: 1.25rem;
    font-size: 1rem;
  }
  
  .checkout-container {
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  
  .checkout-summary {
    position: static;
    margin-top: 0;
  }
  
  .checkout-item {
    grid-template-columns: 80px 1fr;
    gap: 1rem;
  }
  
  .checkout-item-actions {
    grid-column: 1 / -1;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e8e6e3;
  }
  
  .customization-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .checkout-item-image {
    width: 80px;
    height: 100px;
  }
  
  .customization-item {
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
  }
}
</style>

<script>
// Enhanced checkout functionality with removal and full customization display
document.addEventListener('DOMContentLoaded', function() {
  loadCheckoutData();
  setupStripeCheckout();
});

// Customization mapping for display
const CUSTOMIZATION_DISPLAY = {
  silhouette: { icon: 'üëó', label: 'Silhouette' },
  neckline: { icon: 'üíé', label: 'Neckline' },
  sleeves: { icon: 'üëî', label: 'Sleeves' },
  back: { icon: 'üîô', label: 'Back Style' },
  train: { icon: 'üë∏', label: 'Train' },
  material: { icon: '‚ú®', label: 'Fabric' },
  color: { icon: 'üé®', label: 'Color' },
  waistline: { icon: 'üìè', label: 'Waistline' },
  embellishments: { icon: 'üíç', label: 'Embellishments' },
  bust: { icon: 'üëô', label: 'Bust Support' },
  layers: { icon: 'üé™', label: 'Skirt Layers' }
};

function loadCheckoutData() {
  const cartData = localStorage.getItem('rozaBridalCart');
  const cartItems = cartData ? JSON.parse(cartData) : [];
  
  const checkoutItems = document.getElementById('checkout-items');
  const emptyCartNotice = document.getElementById('empty-cart-notice');
  const checkoutTotals = document.getElementById('checkout-totals');
  const stripeButton = document.getElementById('stripe-checkout-button');
  
  if (cartItems.length === 0) {
    emptyCartNotice.style.display = 'block';
    checkoutItems.style.display = 'none';
    checkoutTotals.style.display = 'none';
    stripeButton.style.display = 'none';
    return;
  }
  
  // Hide empty cart message
  emptyCartNotice.style.display = 'none';
  checkoutItems.style.display = 'block';
  checkoutTotals.style.display = 'block';
  stripeButton.style.display = 'flex';
  stripeButton.disabled = false;
  
  // Auto-fill user data if logged in
  const userData = localStorage.getItem('rozaBridalUser');
  if (userData) {
    const user = JSON.parse(userData);
    document.getElementById('checkout-first-name').value = user.firstName || '';
    document.getElementById('checkout-last-name').value = user.lastName || '';
    document.getElementById('checkout-email').value = user.email || '';
    if (user.weddingDate) document.getElementById('checkout-wedding-date').value = user.weddingDate;
  }
  
  // Populate checkout items with enhanced customization display
  checkoutItems.innerHTML = cartItems.map((item, index) => {
    return renderEnhancedCheckoutItem(item, index);
  }).join('');
  
  // Calculate totals
  const subtotal = cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);
  const total = subtotal;
  
  // Update totals
  document.getElementById('checkout-subtotal').textContent = `$${subtotal.toFixed(2)}`;
  document.getElementById('checkout-total').textContent = `$${total.toFixed(2)}`;
  
  // Add event listeners for remove buttons and quantity controls
  setupCheckoutItemControls();
}

function renderEnhancedCheckoutItem(item, index) {
  // Fix image path
  let imagePath;
  if (item.image && item.image.startsWith('http')) {
    imagePath = item.image;
  } else if (item.image && item.image.includes('/assets/')) {
    imagePath = item.image;
  } else if (item.image) {
    imagePath = `{{ site.baseurl }}/assets/images/${item.image}`;
  } else {
    imagePath = `{{ site.baseurl }}/assets/images/placeholder-dress.jpg`;
  }

  // Enhanced customization display
  const customizationHtml = item.isCustom && item.customizations ? 
    renderFullCustomizationDetails(item.customizations) : '';
  
  return `
    <div class="checkout-item" data-item-index="${index}">
      <img src="${imagePath}" alt="${item.name}" class="checkout-item-image" onerror="this.src='{{ site.baseurl }}/assets/images/placeholder-dress.jpg'">
      
      <div class="checkout-item-details">
        <h4>${item.name}</h4>
        <p class="checkout-item-meta">Size: ${item.size}</p>
        <p class="checkout-item-price">$${(item.price * item.quantity).toFixed(2)}</p>
        
        <div class="checkout-quantity-controls">
          <button class="checkout-quantity-btn" onclick="updateCheckoutQuantity(${index}, -1)">‚àí</button>
          <div class="checkout-quantity-display">${item.quantity}</div>
          <button class="checkout-quantity-btn" onclick="updateCheckoutQuantity(${index}, 1)">+</button>
        </div>
        
        ${customizationHtml}
      </div>
      
      <div class="checkout-item-actions">
        <button class="remove-checkout-item" onclick="removeCheckoutItem(${index})">
          <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3,6 5,6 21,6"></polyline>
            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          Remove
        </button>
      </div>
    </div>
  `;
}

function renderFullCustomizationDetails(customizations) {
  if (!customizations) return '';
  
  const customizationItems = [];
  
  // Process all customization options
  Object.entries(customizations).forEach(([key, value]) => {
    if (key === 'specialRequests') return; // Handle separately
    if (!value || value === 'none') return;
    
    const displayInfo = CUSTOMIZATION_DISPLAY[key];
    if (displayInfo) {
      customizationItems.push({
        icon: displayInfo.icon,
        label: displayInfo.label,
        value: formatCustomizationValue(value)
      });
    }
  });
  
  const customizationGrid = customizationItems.map(item => `
    <div class="customization-item">
      <span class="customization-icon">${item.icon}</span>
      <span class="customization-label">${item.label}:</span>
      <span class="customization-value">${item.value}</span>
    </div>
  `).join('');
  
  const specialRequestsHtml = customizations.specialRequests ? `
    <div class="special-requests-display">
      <strong>üíå Special Requests:</strong>
      <p>${customizations.specialRequests}</p>
    </div>
  ` : '';
  
  return `
    <div class="checkout-item-customizations">
      <h5>‚ú® Custom Design Details</h5>
      <div class="customization-grid">
        ${customizationGrid}
      </div>
      ${specialRequestsHtml}
    </div>
  `;
}

function formatCustomizationValue(value) {
  // Convert camelCase to readable format
  return value.replace(/([A-Z])/g, ' $1')
              .replace(/^./, str => str.toUpperCase())
              .replace(/([a-z])([A-Z])/g, '$1 $2');
}

function removeCheckoutItem(index) {
  const cartData = localStorage.getItem('rozaBridalCart');
  if (!cartData) return;
  
  const cartItems = JSON.parse(cartData);
  
  // Confirm removal
  const item = cartItems[index];
  const confirmMessage = `Are you sure you want to remove "${item.name}" from your order?`;
  
  if (confirm(confirmMessage)) {
    cartItems.splice(index, 1);
    localStorage.setItem('rozaBridalCart', JSON.stringify(cartItems));
    
    // Update cart icon if available
    if (window.cart && typeof window.cart.updateCartIcon === 'function') {
      window.cart.updateCartIcon();
    }
    
    // Reload checkout data
    loadCheckoutData();
    
    // Show confirmation
    showRemovalNotification(item.name);
  }
}

function updateCheckoutQuantity(index, change) {
  const cartData = localStorage.getItem('rozaBridalCart');
  if (!cartData) return;
  
  const cartItems = JSON.parse(cartData);
  const item = cartItems[index];
  
  const newQuantity = item.quantity + change;
  if (newQuantity < 1 || newQuantity > 10) return;
  
  cartItems[index].quantity = newQuantity;
  localStorage.setItem('rozaBridalCart', JSON.stringify(cartItems));
  
  // Update cart icon if available
  if (window.cart && typeof window.cart.updateCartIcon === 'function') {
    window.cart.updateCartIcon();
  }
  
  // Reload checkout data
  loadCheckoutData();
}

function showRemovalNotification(itemName) {
  // Create notification
  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
    z-index: 10000;
    font-weight: 600;
    max-width: 300px;
    animation: slideIn 0.3s ease;
  `;
  
  notification.innerHTML = `
    <div style="display: flex; align-items: center; gap: 0.5rem;">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="20,6 9,17 4,12"></polyline>
      </svg>
      <span>Removed "${itemName}" from cart</span>
    </div>
  `;
  
  document.body.appendChild(notification);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease forwards';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

function setupCheckoutItemControls() {
  // Event listeners are handled by onclick attributes in the HTML
  // This function can be extended for additional setup if needed
}

function setupStripeCheckout() {
  const stripeButton = document.getElementById('stripe-checkout-button');
  
  stripeButton.addEventListener('click', function() {
    if (validateCheckoutForm()) {
      processStripeCheckout();
    }
  });
}

function validateCheckoutForm() {
  const requiredFields = [
    'checkout-first-name',
    'checkout-last-name',
    'checkout-email',
    'checkout-phone'
  ];
  
  let isValid = true;
  
  requiredFields.forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (!field.value.trim()) {
      field.style.borderColor = '#dc3545';
      isValid = false;
    } else {
      field.style.borderColor = '#c9a96e';
    }
  });
  
  if (!isValid) {
    alert('Please fill in all required fields.');
    return false;
  }
  
  return true;
}

function processStripeCheckout() {
  const cartData = localStorage.getItem('rozaBridalCart');
  const cartItems = cartData ? JSON.parse(cartData) : [];
  
  if (cartItems.length === 0) {
    alert('Your cart is empty!');
    return;
  }
  
  // Get customer details
  const customerDetails = {
    firstName: document.getElementById('checkout-first-name').value,
    lastName: document.getElementById('checkout-last-name').value,
    email: document.getElementById('checkout-email').value,
    phone: document.getElementById('checkout-phone').value,
    weddingDate: document.getElementById('checkout-wedding-date').value,
    venueStyle: document.getElementById('checkout-venue-style').value,
    notes: document.getElementById('order-notes').value
  };
  
  // Show processing state
  const stripeButton = document.getElementById('stripe-checkout-button');
  const originalContent = stripeButton.innerHTML;
  stripeButton.innerHTML = '<div class="spinner"></div> Processing...';
  stripeButton.disabled = true;
  
  console.log('üí≥ Processing Stripe checkout...');
  
  // STRIPE PAYMENT - SINGLE ITEM ONLY (all options same price)
  if (cartItems.length === 1) {
    const item = cartItems[0];
    const cleanName = item.name.replace(/\s*\(Custom\)$/, '');
    
    // Direct Stripe links - ALL OPTIONS SAME PRICE
    const stripeLinks = {
      'Boho Wedding Dress Elegant': 'https://buy.stripe.com/4gM3cv3TA7sRc093EN1B600',
      'Boho Beach Wedding Dress': 'https://buy.stripe.com/7sY6oHdua7sR6FP0sB1B601',
      'Custom Lace Mermaid Wedding Dress': 'https://buy.stripe.com/5kQ00jcq614t4xH2AJ1B602',
      'Custom Lace Mermaid Wedding Dress V-Neck': 'https://buy.stripe.com/00waEX2PweVj5BL6QZ1B603',
      'Elegant Ivory Satin Bridal Gown': 'https://buy.stripe.com/3cI4gz2Pw8wV7JT6QZ1B604',
      'Floral Bridal Dress': 'https://buy.stripe.com/cNi3cv9dUfZnggpcbj1B605',
      'Gorgeous Ivory Mermaid Wedding Gown': 'https://buy.stripe.com/7sYaEX75MdRf0hrgrz1B606',
      'Minimalist Off Shoulder Satin Wedding Dress': 'https://buy.stripe.com/28E9ATgGm9AZ7JTdfn1B607',
      'Modest Satin Wedding Dress': 'https://buy.stripe.com/4gM3cvcq6cNbc09dfn1B608',
      'Sexy Fishtail Bridal Gown': 'https://buy.stripe.com/eVqdR9bm2fZn4xHcbj1B609',
      'Sexy Sequin Mermaid Wedding Dress': 'https://buy.stripe.com/7sY00jeye28xe8h7V31B60a'
    };
    
    const stripeLink = stripeLinks[cleanName];
    
    if (stripeLink) {
      // Reset button immediately
      stripeButton.innerHTML = originalContent;
      stripeButton.disabled = false;
      
      // Save order context for tracking
      const orderContext = {
        item: item,
        customer: customerDetails,
        timestamp: Date.now(),
        orderId: 'RB-' + Date.now()
      };
      localStorage.setItem('stripeOrderContext', JSON.stringify(orderContext));
      
      // Track checkout
      if (typeof ml !== 'undefined') {
        ml('track', 'stripe_checkout_started', {
          product_name: item.name,
          customer_email: customerDetails.email,
          has_customizations: item.isCustom,
          checkout_method: 'cart_to_stripe',
          all_customizations: item.customizations ? JSON.stringify(item.customizations) : null
        });
      }
      
      // SAVE CHECKOUT STATE BEFORE OPENING STRIPE
      saveCheckoutState(cartItems, customerDetails);
      
      // OPEN STRIPE IN NEW TAB
      console.log('üöÄ Opening Stripe in new tab:', stripeLink);
      window.open(stripeLink, '_blank');
      
      // Show success message
      setTimeout(() => {
        alert('üí≥ Stripe checkout opened in new tab!\n\n‚úÖ Complete your payment there\nüîÑ You can return here if needed\n\nüí° Need changes? Just email us at aetophis@aetophis.com');
      }, 500);
      
      return true;
    } else {
      // Reset button
      stripeButton.innerHTML = originalContent;
      stripeButton.disabled = false;
      alert('‚ùå This product is not available for direct checkout.\n\nPlease contact us at aetophis@aetophis.com to complete your order.');
      return;
    }
  } else {
    // Multiple items
    stripeButton.innerHTML = originalContent;
    stripeButton.disabled = false;
    alert('üì¶ Multiple items detected!\n\nFor orders with multiple items, please contact us at aetophis@aetophis.com and we\'ll send you a secure payment link.\n\nThis ensures the best service for complex orders!');
    return;
  }
}

// Save checkout state before Stripe redirect
function saveCheckoutState(cartItems, customerDetails) {
  const checkoutState = {
    cart: cartItems,
    customer: customerDetails,
    timestamp: Date.now(),
    status: 'stripe_redirect'
  };
  
  localStorage.setItem('checkoutState', JSON.stringify(checkoutState));
  localStorage.setItem('checkoutStateBackup', JSON.stringify(checkoutState));
  sessionStorage.setItem('checkoutState', JSON.stringify(checkoutState));
  
  console.log('üíæ Checkout state saved before Stripe redirect');
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
  
  /* Enhanced form styling */
  .checkout-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 0 1rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    align-items: start;
  }
  
  .checkout-section {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.04);
    margin-bottom: 2rem;
    border-left: 4px solid #8b7355;
  }
  
  .checkout-section h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    color: #1a1a1a;
    margin: 0 0 1.5rem 0;
    font-weight: 400;
  }
  
  .form-group {
    margin-bottom: 1.5rem;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: #1a1a1a;
  }
  
  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e8e6e3;
    border-radius: 8px;
    font-family: inherit;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: white;
  }
  
  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    border-color: #8b7355;
    outline: none;
    box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.1);
  }
  
  .checkout-summary {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.04);
    height: fit-content;
    position: sticky;
    top: 2rem;
  }
  
  .checkout-summary h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.8rem;
    color: #1a1a1a;
    margin: 0 0 1.5rem 0;
    font-weight: 400;
    text-align: center;
  }
  
  .checkout-totals {
    background: linear-gradient(135deg, #f8f9fa 0%, #f0f4f7 100%);
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1.5rem 0;
  }
  
  .checkout-total-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid rgba(139, 115, 85, 0.1);
  }
  
  .checkout-total-row:last-child {
    border-bottom: none;
  }
  
  .checkout-total-row.final {
    font-weight: 600;
    font-size: 1.1rem;
    color: #1a1a1a;
    padding-top: 1rem;
    border-top: 2px solid #8b7355;
    margin-top: 0.5rem;
  }
  
  @media (max-width: 768px) {
    .checkout-container {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
    
    .checkout-summary {
      position: static;
    }
    
    .checkout-section {
      padding: 1.5rem;
    }
  }
`;

document.head.appendChild(style);
